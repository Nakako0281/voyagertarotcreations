---
interface Props {
    isHome?: boolean;
}
const { isHome = false } = Astro.props;
---

<header
    class="fixed w-full top-0 z-50 transition-all duration-300 pointer-events-none"
    id="main-header"
    data-is-home={isHome ? "true" : "false"}
>
    <div
        class={`absolute inset-0 bg-white/90 backdrop-blur-md -z-10 transition-opacity duration-300 shadow-sm ${isHome ? "opacity-0" : "opacity-100"}`}
        id="header-bg"
    >
    </div>

    <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-20 flex items-center justify-between pointer-events-auto transition-all duration-300"
        id="header-container"
    >
        <!-- Logo -->
        <a href="/" class="group flex flex-col justify-center">
            <span
                class={`text-2xl font-bold tracking-widest drop-shadow-md group-hover:text-magenta-pale transition-colors ${isHome ? "text-white" : "text-text-dark"}`}
                id="header-logo-text"
            >
                Voyager Tarot
            </span>
            <span
                class={`text-[0.6rem] tracking-[0.3em] uppercase group-hover:text-text-dark transition-colors ${isHome ? "text-white/80" : "text-text-dark/80"}`}
                id="header-logo-sub"
            >
                Creations
            </span>
        </a>

        <!-- Desktop Nav -->
        <nav class="hidden md:flex items-center space-x-8">
            {
                [
                    { name: "HOME", href: "/" },
                    { name: "PROFILE", href: "/profile" },
                    { name: "COURSE", href: "/course" },
                    { name: "NEWS", href: "/news" },
                ].map((item) => (
                    <a
                        href={item.href}
                        class={`nav-link font-bold text-sm tracking-widest hover:text-magenta-pale transition-colors drop-shadow-sm relative group py-2 ${isHome ? "text-white" : "text-text-dark"}`}
                    >
                        {item.name}
                        <span class="absolute bottom-0 left-0 w-0 h-0.5 bg-magenta-pale transition-all duration-300 group-hover:w-full" />
                    </a>
                ))
            }
            <a
                href="/contact"
                class={`nav-btn ml-4 px-6 py-2 rounded-full font-bold text-sm tracking-widest hover:bg-white hover:text-text-dark transition-all duration-300 backdrop-blur-sm shadow-sm hover:shadow-lg hover:shadow-indigo-500/30 ${isHome ? "border border-white/60 text-white" : "border border-text-dark/30 text-text-dark"}`}
            >
                CONTACT
            </a>
        </nav>

        <!-- Mobile Menu Button -->
        <button
            id="mobile-menu-btn"
            class={`md:hidden p-2 focus:outline-none ${isHome ? "text-white" : "text-text-dark"}`}
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </div>
</header>

<!-- Mobile Menu Overlay -->
<nav
    id="mobile-menu"
    class="fixed inset-0 bg-white/95 backdrop-blur-xl z-40 flex flex-col items-center justify-center gap-8 opacity-0 pointer-events-none transition-opacity duration-300 text-text-dark"
>
    <a
        href="/"
        class="text-2xl font-bold hover:text-sakura-vivid transition-colors"
        >HOME</a
    >
    <a
        href="/profile"
        class="text-2xl font-bold hover:text-sakura-vivid transition-colors"
        >PROFILE</a
    >
    <a
        href="/course"
        class="text-2xl font-bold hover:text-sakura-vivid transition-colors"
        >COURSE</a
    >
    <a
        href="/news"
        class="text-2xl font-bold hover:text-sakura-vivid transition-colors"
        >NEWS</a
    >
    <a
        href="/contact"
        class="text-2xl font-bold text-sakura-vivid hover:text-pink-600 transition-colors"
        >CONTACT</a
    >
</nav>

<script>
    const header = document.getElementById("main-header");
    const headerBg = document.getElementById("header-bg");
    const logoText = document.getElementById("header-logo-text");
    const logoSub = document.getElementById("header-logo-sub");
    const navLinks = document.querySelectorAll(".nav-link");
    const navBtn = document.querySelector(".nav-btn");
    const mobileBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");

    const isHome = header?.dataset.isHome === "true";

    // Scroll Listener
    const handleScroll = () => {
        // Condition: If NOT home, always apply 'scrolled' style. If IS home, only apply when scrolled > 20.
        if (!isHome || window.scrollY > 20) {
            // Scrolled / Subpage state: White background, Dark text
            headerBg?.classList.remove("opacity-0");
            headerBg?.classList.add("opacity-100");

            logoText?.classList.remove("text-white");
            logoText?.classList.add("text-text-dark");
            logoSub?.classList.remove("text-white/80");
            logoSub?.classList.add("text-text-dark/80");

            navLinks.forEach((link) => {
                link.classList.remove("text-white");
                link.classList.add("text-text-dark");
            });

            navBtn?.classList.remove("text-white", "border-white/60");
            navBtn?.classList.add("text-text-dark", "border-text-dark/30");

            mobileBtn?.classList.remove("text-white");
            mobileBtn?.classList.add("text-text-dark");
        } else {
            // Top state (Home only): Transparent background, White text
            headerBg?.classList.add("opacity-0");
            headerBg?.classList.remove("opacity-100");

            logoText?.classList.add("text-white");
            logoText?.classList.remove("text-text-dark");
            logoSub?.classList.add("text-white/80");
            logoSub?.classList.remove("text-text-dark/80");

            navLinks.forEach((link) => {
                link.classList.add("text-white");
                link.classList.remove("text-text-dark");
            });

            navBtn?.classList.add("text-white", "border-white/60");
            navBtn?.classList.remove("text-text-dark", "border-text-dark/30");

            mobileBtn?.classList.add("text-white");
            mobileBtn?.classList.remove("text-text-dark");
        }
    };

    window.addEventListener("scroll", handleScroll);
    // Init check
    handleScroll();

    // Mobile Menu Logic
    mobileBtn?.addEventListener("click", () => {
        if (mobileMenu?.classList.contains("opacity-0")) {
            mobileMenu?.classList.remove("opacity-0", "pointer-events-none");
            document.body.style.overflow = "hidden";
            // Ensure button is visible/colored for contrast
            mobileBtn?.classList.add("text-text-dark");
            mobileBtn?.classList.remove("text-white");
        } else {
            mobileMenu?.classList.add("opacity-0", "pointer-events-none");
            document.body.style.overflow = "";
            handleScroll(); // Restore correct color based on scroll/page
        }
    });

    // Close mobile menu on link click
    mobileMenu?.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
            mobileMenu.classList.add("opacity-0", "pointer-events-none");
            document.body.style.overflow = "";
            handleScroll();
        });
    });
</script>
