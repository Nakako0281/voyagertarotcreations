---
import Layout from '../../layouts/Layout.astro';
import { getNews } from '../../library/microcms';

const response = await getNews({ fields: ["id", "title", "publishedAt", "category", "eyecatch"] });
const { contents: newsList } = response;

import { format } from 'date-fns';

function formatDate(dateString: string) {
    return format(new Date(dateString), 'yyyy.MM.dd');
}
---

<Layout title="News">
    <div class="space-y-12">
        <header class="text-center mb-12">
            <h1 class="text-3xl md:text-4xl font-mincho text-tarot-blue mb-4">News</h1>
            <p class="text-gray-500">お知らせ</p>
        </header>

        <div class="grid gap-6">
            {newsList.map((news) => (
                <a href={`/news/${news.id}`} class="block bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md hover:border-sakura-pink transition-all group">
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="md:w-48 h-32 bg-gray-100 rounded-lg overflow-hidden shrink-0">
                            {news.eyecatch ? (
                                <img src={news.eyecatch.url} alt={news.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                            ) : (
                                <div class="w-full h-full flex items-center justify-center bg-gray-50 text-gray-300">
                                    <span class="text-2xl">Voyager</span>
                                </div>
                            )}
                        </div>
                        <div class="flex-1 flex flex-col justify-center">
                            <div class="flex items-center gap-3 mb-2">
                                <time class="text-sm text-gray-400 font-sans">{formatDate(news.publishedAt)}</time>
                                {news.category.map(cat => (
                                    <span class="text-xs text-sakura-pink font-bold border border-sakura-pink/30 px-2 py-0.5 rounded-full">
                                        {cat.name}
                                    </span>
                                ))}
                            </div>
                            <h2 class="text-lg md:text-xl font-bold font-mincho text-gray-800 group-hover:text-sakura-pink transition-colors line-clamp-2">
                                {news.title}
                            </h2>
                        </div>
                    </div>
                </a>
            ))}
        </div>
    </div>
</Layout>
