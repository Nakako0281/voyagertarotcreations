---
import Layout from '../layouts/Layout.astro';
import TarotDraw from '../components/react/TarotDraw.tsx';
import { getNews } from '../library/microcms';
import { format } from 'date-fns';

const response = await getNews({ limit: 3, fields: ["id", "title", "publishedAt", "category", "eyecatch"] });
const { contents: newsList } = response;

function formatDate(dateString: string) {
    return format(new Date(dateString), 'yyyy.MM.dd');
}
// const newsList: any[] = [];
---

<Layout title="Home">
	<!-- Hero Section -->
	<section class="mb-16 text-center py-20 bg-gradient-to-b from-transparent to-sakura-pink/5 rounded-3xl">
		<h1 class="text-4xl md:text-5xl font-mincho font-bold text-tarot-blue mb-4 leading-tight">
			Voyager Tarot Creations
		</h1>
		<p class="text-lg md:text-xl text-gray-600 mb-8 font-mincho">
			あなたの人生を創造する、<br class="md:hidden" />魔法のカード。
		</p>
		<div class="flex justify-center gap-4">
			<a href="#tarot-draw" class="bg-sakura-pink text-white px-8 py-3 rounded-full shadow-lg hover:bg-pink-400 transition-colors">
				今日の1枚を引く
			</a>
			<a href="/course" class="bg-white text-tarot-blue border border-tarot-blue px-8 py-3 rounded-full hover:bg-tarot-blue hover:text-white transition-colors">
				講座を見る
			</a>
		</div>
	</section>

	<!-- News Section -->
	<section class="mb-16">
		<div class="flex items-center justify-between mb-6">
			<h2 class="text-2xl font-mincho text-tarot-blue border-l-4 border-sakura-pink pl-3">News</h2>
			<a href="/news" class="text-sm text-gray-500 hover:text-sakura-pink">一覧を見る &rarr;</a>
		</div>
		<div class="grid gap-4 md:grid-cols-3">
			{newsList.map((news) => (
				<a href={`/news/${news.id}`} class="block bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow group">
					<div class="h-32 bg-gray-100 rounded-lg mb-3 overflow-hidden">
                         {news.eyecatch ? (
                            <img src={news.eyecatch.url} alt={news.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                        ) : (
                            <div class="w-full h-full flex items-center justify-center bg-gray-50 text-gray-300">
                                <span class="text-sm">Voyager</span>
                            </div>
                        )}
                    </div>
					<div class="flex items-center gap-2 mb-2">
                        <span class="text-xs text-sakura-pink font-bold border border-sakura-pink/30 px-2 py-0.5 rounded-full">
                            {news.category[0]?.name}
                        </span>
                        <time class="text-xs text-gray-400">{formatDate(news.publishedAt)}</time>
                    </div>
					<h3 class="font-bold mt-1 text-sm line-clamp-2 text-gray-800 group-hover:text-sakura-pink transition-colors">{news.title}</h3>
				</a>
			))}
		</div>
	</section>

	<!-- About Section -->
	<section class="mb-16 grid md:grid-cols-2 gap-8 items-center">
		<div class="order-2 md:order-1">
			<h2 class="text-2xl font-mincho text-tarot-blue mb-4">Voyager Tarot Creationsについて</h2>
			<p class="leading-relaxed text-gray-600 mb-4">
				ボイジャータロットは、21世紀のタロットカード。<br/>
				伝統的なタロットの叡智と、現代の心理学や宇宙論を融合させた、
				「行動」と「直感」のためのカードです。
			</p>
			<a href="/about" class="text-sakura-pink hover:underline underline-offset-4">もっと詳しく &rarr;</a>
		</div>
		<div class="order-1 md:order-2 h-64 bg-gray-200 rounded-2xl">
			<!-- Image placeholder -->
		</div>
	</section>

	<!-- Tarot Draw Feature -->
	<section id="tarot-draw" class="mb-16 py-12 px-4 bg-tarot-blue text-white rounded-3xl text-center relative overflow-hidden">
		<div class="relative z-10">
			<h2 class="text-3xl font-mincho mb-8">Today's Voyager</h2>
			<p class="mb-8 opacity-90">今のあなたに必要なメッセージを受け取りましょう。</p>
			
			<TarotDraw client:visible />
		</div>
		<!-- Decorative bg elements -->
		<div class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white/10 to-transparent opacity-30"></div>
	</section>

</Layout>
