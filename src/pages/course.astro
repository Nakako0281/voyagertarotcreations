---
import Layout from "../layouts/Layout.astro";

// Data Definitions
const courseCategories = [
    {
        id: "voyager",
        title: "ボイジャータロット",
        sub: "Voyager Tarot",
        description: "ボイジャータロットの認定講座です。基礎からプロフェッショナルまで段階的に学べます。",
        courses: [
            {
                id: "reader",
                step: "STEP 1",
                stepColor: "sakura-vivid", // Red
                bgGradient: "bg-sakura-light/40",
                title: "認定リーダー養成講座",
                subtitle: "基礎を学び、自分と他者をリーディングできるようになる",
                description: "ボイジャータロットの基礎と78枚のカードの解説、基本のリーディングを学びます。<br />ボイジャータロットがどんなカードかを理解し、自分で行うセルフリーディングから他者への基礎リーディングが出来るようになります。",
                subCourses: [
                    {
                        title: "STEP 1-1: ベーシック講座",
                        duration: "12時間 (4時間×3回)",
                        description: "カードの基礎知識、直感の磨き方、基本スプレッドを習得し、有料セッションへの第一歩を踏み出します。",
                        condition: null
                    },
                    {
                        title: "STEP 1-2: アドバンス講座",
                        duration: "12時間 (4時間×3回)",
                        description: "基礎リーディングが出来るようになったら次のステップへ。大型スプレッドを学び、プロとしてのリーディングスキルを磨きます。",
                        condition: {
                            title: "認定条件",
                            items: ["20時間のリーディング記録の提出", "認定テスト（モニターセッション30分）"],
                            color: "sakura-vivid",
                            bgColor: "bg-pink-50/50",
                            borderColor: "border-pink-100/50"
                        }
                    }
                ],
                 pricing: [
                    { title: "認定リーダー養成講座 (ベーシック)", duration: "全12時間", price: "¥55,000" },
                    { title: "認定リーダー養成講座 (アドバンス)", duration: "全12時間", price: "¥55,000" }
                ]
            },
            {
                id: "coach",
                step: "STEP 2",
                stepColor: "sunshine", // Yellow
                bgGradient: "bg-sunshine/20",
                title: "認定コーチ養成講座",
                subtitle: "質問力を磨き、行動を促すコーチングスキルを習得",
                description: "単なる占いのツールではなく、行動を促し未来をクリエイトするのがボイジャータロットのパワー。<br />ボイジャーを使った実践的なコーチングスキルを学び、自分自身も取り組むことで、学びと行動の習慣化を両立します。",
                subCourses: [
                    {
                        title: "コーチ認定講座",
                        duration: "12時間 (3時間×4回)",
                        description: "質問力を磨き、クライアントの答えを引き出すコーチング手法を習得します。<br />継続セッションの技術も学び、リピーターに繋がる実力をつけます。",
                        condition: {
                            title: "認定条件",
                            items: ["3名の方に3回の継続セッションを実施・記録提出", "認定テスト（モニターセッション60分）"],
                            color: "sunshine",
                            bgColor: "bg-yellow-50/50",
                            borderColor: "border-yellow-100/50"
                        }
                    }
                ],
                pricing: [
                    { title: "認定コーチ養成講座", duration: "全12時間", price: "¥88,000" }
                ]
            },
            {
                id: "teacher",
                step: "STEP 3",
                stepColor: "sky", // Blue
                bgGradient: "bg-sky/20",
                title: "認定ティーチャー養成講座",
                subtitle: "ボイジャータロットを教え、広める存在になる",
                description: "認定ティーチャーとして『リーダー認定講座(ベーシック・アドバンス)』を開催できるようになります。<br />教える立場になることで、カードへの理解が圧倒的に深まり、ビジネスとしての活動の幅も広がります。",
                subCourses: [
                    {
                        title: "ティーチャー認定講座",
                        duration: "要問い合わせ",
                        description: "インストラクション技術、集客、ブランディングなど、指導者・経営者としてのスキルを総合的に学びます。",
                        condition: {
                            title: "認定条件",
                            items: ["50時間の有料セッション実施・記録提出", "講座アシスタント経験・集客実績", "レポート提出"],
                            color: "sky",
                            bgColor: "bg-blue-50/50",
                            borderColor: "border-blue-100/50"
                        }
                    }
                ],
                pricing: [
                    { title: "認定ティーチャー養成講座", duration: "要問い合わせ", price: "¥120,000" }
                ]
            }
        ]
    },
    {
        id: "other",
        title: "その他講座（例）",
        sub: "Other Courses",
        description: "数秘術や占星術など、その他の講座も準備中です。",
        courses: [
             {
                id: "example",
                step: "COMING SOON",
                stepColor: "gray-400",
                bgGradient: "bg-gray-100",
                title: "数秘術講座（準備中）",
                subtitle: "数字の神秘を学び、自己理解を深める",
                description: "現在準備中です。公開までしばらくお待ちください。",
                subCourses: [],
                pricing: []
            }
        ]
    }
];
---

<Layout title="Course Guide">
    <div class="space-y-16">
        <!-- Header -->
        <header class="text-center mb-16 relative">
            <h1
                class="text-5xl md:text-7xl font-serif font-black tracking-wider text-text-dark bg-clip-text bg-gradient-to-r from-text-dark to-slate-500 mb-4 drop-shadow-sm"
            >
                Course Guide
            </h1>
            <div class="w-16 h-[2px] bg-magenta mx-auto mt-6 mb-8"></div>
        </header>

        <!-- Main Content Layout -->
        <div class="grid md:grid-cols-12 gap-8 items-start relative">
            
            <!-- Sidebar Navigation (Sticky on Desktop) -->
            <aside class="md:col-span-3 md:sticky md:top-32 z-20">
                <nav class="bg-white/50 backdrop-blur-md rounded-[2rem] p-4 border border-white shadow-glass">
                    <ul class="flex md:flex-col gap-2 overflow-x-auto md:overflow-visible pb-2 md:pb-0 touch-action-pan-x snap-x no-scrollbar">
                        {courseCategories.map((cat, index) => (
                            <li class="snap-start shrink-0">
                                <button
                                    class:list={[
                                        "category-tab w-full text-center justify-center px-6 py-4 rounded-xl transition-all duration-300 font-bold tracking-wide flex items-center gap-3 group border border-transparent whitespace-nowrap",
                                        index === 0 
                                            ? "bg-text-dark text-white shadow-lg shadow-gray-200" 
                                            : "hover:bg-white hover:shadow-md text-gray-500 hover:text-text-dark"
                                    ]}
                                    data-target={cat.id}
                                >
                                    <span class:list={[
                                        "w-2 h-2 rounded-full transition-colors duration-300",
                                        index === 0 ? "bg-sakura-vivid" : "bg-gray-300 group-hover:bg-text-dark"
                                    ]}></span>
                                    <div class="flex flex-col items-center">
                                        <span class="text-sm md:text-base">{cat.title}</span>
                                        <span class="text-[10px] uppercase tracking-widest opacity-60 hidden md:block">{cat.sub}</span>
                                    </div>
                                </button>
                            </li>
                        ))}
                    </ul>
                </nav>
            </aside>

            <!-- Course Content Area -->
            <main class="md:col-span-9 min-h-[500px]">
                {courseCategories.map((cat, index) => (
                    <div 
                        id={cat.id} 
                        class:list={["category-content transition-all duration-500 ease-in-out", index !== 0 ? "hidden opacity-0 translate-y-4" : "block opacity-100 translate-y-0"]}
                    >
                        
                        <!-- Category Header -->
                        <div class="mb-12 pl-4 border-l-4 border-magenta">
                            <h2 class="text-3xl font-rounded font-bold text-text-dark mb-2">{cat.title}</h2>
                            <p class="text-gray-500">{cat.description}</p>
                        </div>

                        <div class="space-y-24">
                            {cat.courses.map((course) => (
                                <div
                                    class="bg-white/80 backdrop-blur-md p-8 md:p-12 rounded-[3rem] border border-white shadow-glass relative overflow-hidden group hover:shadow-crystal transition-all duration-500"
                                >
                                    <!-- Background Blob -->
                                    <div
                                        class:list={[
                                            "absolute top-0 right-0 w-64 h-64 rounded-bl-full z-0 blur-3xl",
                                            course.bgGradient
                                        ]}
                                    ></div>

                                    <div class="relative z-10">
                                        <!-- Step Label -->
                                        <span
                                            class:list={[
                                                "font-bold border px-6 py-2 rounded-full text-sm mb-8 inline-block bg-white/80 backdrop-blur shadow-sm tracking-widest",
                                                `text-${course.stepColor}`,
                                                `border-${course.stepColor}/30`
                                            ]}
                                        >
                                            {course.step}
                                        </span>

                                        <h3 class="text-3xl md:text-4xl font-rounded font-bold text-text-dark mb-6">
                                            {course.title}
                                        </h3>
                                        <p class="text-gray-600 mb-12 leading-loose font-rounded">
                                            <Fragment set:html={course.description} />
                                        </p>

                                        <!-- Sub Courses -->
                                        <div class="space-y-8">
                                            {course.subCourses.map((sub) => (
                                                <div class="bg-white/60 p-8 md:p-10 rounded-[2rem] border border-white shadow-sm hover:shadow-md transition-shadow duration-300">
                                                    <div class="flex flex-col md:flex-row justify-between items-baseline mb-4">
                                                        <h4 class="font-bold text-xl text-text-dark flex items-center gap-3 font-rounded">
                                                            <span class:list={["w-3 h-3 rounded-full shadow-sm", `bg-${course.stepColor}`]}></span>
                                                            {sub.title}
                                                        </h4>
                                                        <span class="text-sm font-bold text-gray-500 bg-white border border-gray-100 px-4 py-1.5 rounded-full mt-2 md:mt-0 shadow-sm">
                                                            {sub.duration}
                                                        </span>
                                                    </div>
                                                    <p class="text-gray-600 text-sm leading-relaxed mb-8 font-rounded">
                                                        <Fragment set:html={sub.description} />
                                                    </p>

                                                    {sub.condition && (
                                                        <div class:list={["p-6 rounded-2xl border", sub.condition.bgColor, sub.condition.borderColor]}>
                                                            <h5 class:list={["font-bold text-xs mb-3 uppercase tracking-wider", `text-${sub.condition.color}`]}>
                                                                {sub.condition.title}
                                                            </h5>
                                                            <ul class="list-disc list-inside text-xs text-gray-600 space-y-2 font-bold font-rounded">
                                                                {sub.condition.items.map(item => (
                                                                    <li>{item}</li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <!-- Pricing Table (Per Category) -->
                         {cat.courses.some(c => c.pricing.length > 0) && (
                            <section class="mt-24 bg-white/80 backdrop-blur-sm p-8 md:p-12 rounded-[3rem] border border-white shadow-sm">
                                <h3 class="text-2xl md:text-3xl font-rounded font-bold text-center mb-10 text-text-dark">
                                    {cat.title} 価格一覧
                                </h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left border-collapse">
                                        <thead>
                                            <tr class="bg-gray-50 text-gray-500 text-sm font-rounded tracking-wider">
                                                <th class="p-6 rounded-tl-2xl">講座名</th>
                                                <th class="p-6">時間</th>
                                                <th class="p-6 rounded-tr-2xl text-right">受講料 (税込)</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-100">
                                            {cat.courses.flatMap(c => c.pricing).map((price) => (
                                                <tr class="hover:bg-sakura-light/10 transition-colors">
                                                    <td class="p-6 font-bold text-text-dark font-rounded">{price.title}</td>
                                                    <td class="p-6 text-gray-600 text-sm font-rounded">{price.duration}</td>
                                                    <td class="p-6 text-right font-rounded font-bold text-text-dark">{price.price}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                         )}
                    </div>
                ))}
            </main>
        </div>

        <!-- Application CTA -->
        <div class="mt-16 text-center">
            <a
                href="https://reservia.jp/shop/reserve/..."
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-3 bg-gradient-to-r from-sakura-vivid to-sunshine text-white px-12 py-5 rounded-full font-bold hover:scale-105 transition-all shadow-lg shadow-pink-200 font-rounded tracking-wider group"
            >
                <div>
                     <span class="block text-sm opacity-90 font-normal mb-0.5">外部予約サイトへ</span>
                    講座へのお申し込み
                </div>
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-1 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
            </a>
            <p class="text-gray-400 text-sm mt-4">
                ※ご質問がある場合は <a href="/contact" class="text-sakura-vivid hover:underline decoration-sakura-vivid/50">お問い合わせフォーム</a> へ
            </p>
        </div>
    </div>
</Layout>

<script>
    // Tab Switching Logic
    const tabs = document.querySelectorAll('.category-tab');
    const contents = document.querySelectorAll('.category-content');
    
    // Manual tab switching logic for direct click handling
    function switchTab(targetId) {
         // 1. Reset Tabs
         tabs.forEach(t => {
                t.classList.remove('bg-text-dark', 'text-white', 'shadow-lg', 'shadow-gray-200');
                t.classList.add('hover:bg-white', 'hover:shadow-md', 'text-gray-500', 'hover:text-text-dark');
                
                const marker = t.querySelector('span');
                if(marker) {
                    marker.classList.remove('bg-sakura-vivid');
                    marker.classList.add('bg-gray-300');
                }
            });

            // 2. Find and Activate Tab
            const activeTab = document.querySelector(`.category-tab[data-target="${targetId}"]`);
            if (activeTab) {
                activeTab.classList.remove('hover:bg-white', 'hover:shadow-md', 'text-gray-500', 'hover:text-text-dark');
                activeTab.classList.add('bg-text-dark', 'text-white', 'shadow-lg', 'shadow-gray-200');
                
                const activeMarker = activeTab.querySelector('span');
                if(activeMarker) {
                    activeMarker.classList.remove('bg-gray-300');
                    activeMarker.classList.add('bg-sakura-vivid');
                }
            }

            // 3. Switch Content
            contents.forEach(content => {
                content.classList.add('hidden', 'opacity-0', 'translate-y-4');
                content.classList.remove('block', 'opacity-100', 'translate-y-0');
            });
            
            const targetContent = document.getElementById(targetId);
            if (targetContent) {
                 targetContent.classList.remove('hidden');
                 // Small delay to allow display:block to apply before animating opacity
                 setTimeout(() => {
                    targetContent.classList.remove('opacity-0', 'translate-y-4');
                    targetContent.classList.add('opacity-100', 'translate-y-0');
                 }, 10);
            }
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', (e) => {
             const targetId = (e.currentTarget as HTMLElement).dataset.target;
             if (targetId) switchTab(targetId);
        });
    });

    // Handle hash links for direct deep linking
    window.addEventListener('load', () => {
        if(window.location.hash) {
            const hash = window.location.hash.replace('#', '');
            // Check if hash matches a category ID
            if(document.getElementById(hash) && document.querySelector(`.category-tab[data-target="${hash}"]`)) {
                 switchTab(hash);
            }
        }
    });

</script>

<style>
    /* Hide scrollbar for Chrome, Safari and Opera */
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    /* Hide scrollbar for IE, Edge and Firefox */
    .no-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }
</style>
